<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Cookbook/make-lint-fast">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Make ESLint Fast | Lage</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://microsoft.github.io/lage/docs/Cookbook/make-lint-fast"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Make ESLint Fast | Lage"><meta data-rh="true" name="description" content="version 2"><meta data-rh="true" property="og:description" content="version 2"><link data-rh="true" rel="icon" href="/lage/img/lage-logo.svg"><link data-rh="true" rel="canonical" href="https://microsoft.github.io/lage/docs/Cookbook/make-lint-fast"><link data-rh="true" rel="alternate" href="https://microsoft.github.io/lage/docs/Cookbook/make-lint-fast" hreflang="en"><link data-rh="true" rel="alternate" href="https://microsoft.github.io/lage/docs/Cookbook/make-lint-fast" hreflang="x-default"><link rel="stylesheet" href="/lage/assets/css/styles.92b36086.css">
<link rel="preload" href="/lage/assets/js/runtime~main.7b2bdbce.js" as="script">
<link rel="preload" href="/lage/assets/js/main.47168870.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_oPtH" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/lage/"><div class="navbar__logo"><img src="/lage/img/lage.png" alt="Lage Logo" class="themedImage_BQGR themedImage--light_HAxW"><img src="/lage/img/lage.png" alt="Lage Logo" class="themedImage_BQGR themedImage--dark_bGx0"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/lage/docs/Introduction">Guide</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/microsoft/lage" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_ki11 colorModeToggle_Hewu"><button class="clean-btn toggleButton_MMFG toggleButtonDisabled_Uw7m" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_lgto"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_U96C"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_WqAV"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_MB5r docsWrapper_ct1J"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_iEvu" type="button"></button><div class="docPage_KLoz"><aside class="theme-doc-sidebar-container docSidebarContainer_y0RQ"><div class="sidebar_CUen"><nav class="menu thin-scrollbar menu_jmj1"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item green"><a class="menu__link" href="/lage/docs/Introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lage/docs/Quick Start">Quick Start</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/lage/docs/Tutorial/">Tutorial</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorial&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/lage/docs/Reference/cli">Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/lage/docs/Contributing/packages">Contributing</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/lage/docs/Cookbook/migration">Cookbook</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lage/docs/Cookbook/migration">Migration Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lage/docs/Cookbook/make-jest-fast">Make Jest Fast</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/lage/docs/Cookbook/make-lint-fast">Make ESLint Fast</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lage/docs/Cookbook/make-ts-fast">Make TypeScript Fast</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_sTIZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_Qr34"><div class="docItemContainer_tjFy"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_T5ub" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/lage/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_GlTw"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Cookbook</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Make ESLint Fast</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_wXna theme-doc-toc-mobile tocMobile_Ojys"><button type="button" class="clean-btn tocCollapsibleButton_iI2p">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Make ESLint Fast</h1></header><span class="inline-block px-3 py-1 text-xs font-semibold leading-tight text-gray-800 bg-gray-200 rounded-full mb-8">version 2</span><p>ESLint is a wonderful piece of software that catches many software bugs and code quality issues before you check them into the shared code base in a repository. It comes at the price of speed - ESLint is a single-threaded application that can be difficult to speed up.</p><p>There are several approaches to solving the limitation of the single core issues. One can conceivably create several ESLint processes with different segments or shards of the files to be linted. This could work, but since the division or segmentation changes depending on the number of files at different point in time, it makes the rest of method of acceleration difficult to achieve: remote caching, scoping, and pipelining.</p><p>To combat this, a typical task runners spawn new a new ESLint process PER PACKAGE. With a sufficiently high number of CPU core count, one can recover the inefficiency of creating new ESLint processes by amortization through parallelization. This however, has its drawback as well! If there happens to be a set of very slow-booting plugins for ESLint, then this bootstrap cost becomes the dominant perf bottleneck.</p><p>How can we have the cake and eat it too? Easy! Use dedicated workers!</p><h2 class="anchor anchorWithStickyNavbar_JmGV" id="worker-runner">Worker Runner<a class="hash-link" href="#worker-runner" title="Direct link to heading">​</a></h2><p><code>lage</code> solves this with dedicated workers. The idea is simple: if all of the packages in your monorepo subscribe to the same ESLint configuration, then you can save the bootstrap time by creating a <em>pool</em> of ESLint instances (say, one per CPU core minus one). And have <code>lage</code> feed it files to lint per package. <code>lage</code> scheduler feeds these to the worker if work is NEEDED. Caching, scoping, pipeline all continue to work the same way!</p><h2 class="anchor anchorWithStickyNavbar_JmGV" id="lets-see-some-code">Let&#x27;s see some code!<a class="hash-link" href="#lets-see-some-code" title="Direct link to heading">​</a></h2><p>First, let&#x27;s change our <code>lint</code> task configuration in the pipeline to a &quot;worker&quot; type:</p><pre class="shiki min-light twoslash lsp" style="background-color:#ffffff;color:#24292eff"><div class="language-id">js</div><div class="code-container"><code><div class="line"><span style="color:#C2C3C5">// @filename: lage.config.js</span></div><div class="line"> </div><div class="line"><span style="color:#1976D2"><data-lsp lsp="module export=
(property) export=: {
    pipeline: {
        lint: {
            type: string;
            options: {
                worker: string;
            };
        };
    };
}">module</data-lsp></span><span style="color:#24292EFF">.</span><span style="color:#1976D2"><data-lsp lsp="module export=
(property) export=: {
    pipeline: {
        lint: {
            type: string;
            options: {
                worker: string;
            };
        };
    };
}">exports</data-lsp></span><span style="color:#24292EFF"> </span><span style="color:#D32F2F">=</span><span style="color:#24292EFF"> {</span></div><div class="line"><span style="color:#24292EFF">  <data-lsp lsp="(property) pipeline: {
    lint: {
        type: string;
        options: {
            worker: string;
        };
    };
}">pipeline</data-lsp></span><span style="color:#D32F2F">:</span><span style="color:#24292EFF"> {</span></div><div class="line"><span style="color:#24292EFF">    <data-lsp lsp="(property) lint: {
    type: string;
    options: {
        worker: string;
    };
}">lint</data-lsp></span><span style="color:#D32F2F">:</span><span style="color:#24292EFF"> {</span></div><div class="line"><span style="color:#24292EFF">      <data-lsp lsp="(property) type: string">type</data-lsp></span><span style="color:#D32F2F">:</span><span style="color:#24292EFF"> </span><span style="color:#22863A">&quot;worker&quot;</span><span style="color:#212121">,</span></div><div class="line"><span style="color:#24292EFF">      <data-lsp lsp="(property) options: {
    worker: string;
}">options</data-lsp></span><span style="color:#D32F2F">:</span><span style="color:#24292EFF"> {</span></div><div class="line"><span style="color:#24292EFF">        <data-lsp lsp="(property) worker: string">worker</data-lsp></span><span style="color:#D32F2F">:</span><span style="color:#24292EFF"> </span><span style="color:#22863A">&quot;scripts/eslint-worker.js&quot;</span><span style="color:#212121">,</span></div><div class="line"><span style="color:#24292EFF">      }</span><span style="color:#212121">,</span></div><div class="line"><span style="color:#24292EFF">    }</span><span style="color:#212121">,</span></div><div class="line"><span style="color:#24292EFF">  }</span><span style="color:#212121">,</span></div><div class="line"><span style="color:#24292EFF">};</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><pre class="shiki nord twoslash lsp" style="background-color:#2e3440ff;color:#d8dee9ff"><div class="language-id">js</div><div class="code-container"><code><div class="line"><span style="color:#616E88">// @filename: lage.config.js</span></div><div class="line"> </div><div class="line"><span style="color:#8FBCBB"><data-lsp lsp="module export=
(property) export=: {
    pipeline: {
        lint: {
            type: string;
            options: {
                worker: string;
            };
        };
    };
}">module</data-lsp></span><span style="color:#ECEFF4">.</span><span style="color:#8FBCBB"><data-lsp lsp="module export=
(property) export=: {
    pipeline: {
        lint: {
            type: string;
            options: {
                worker: string;
            };
        };
    };
}">exports</data-lsp></span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></div><div class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#88C0D0"><data-lsp lsp="(property) pipeline: {
    lint: {
        type: string;
        options: {
            worker: string;
        };
    };
}">pipeline</data-lsp></span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></div><div class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#88C0D0"><data-lsp lsp="(property) lint: {
    type: string;
    options: {
        worker: string;
    };
}">lint</data-lsp></span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></div><div class="line"><span style="color:#D8DEE9FF">      </span><span style="color:#88C0D0"><data-lsp lsp="(property) type: string">type</data-lsp></span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">worker</span><span style="color:#ECEFF4">&quot;</span><span style="color:#ECEFF4">,</span></div><div class="line"><span style="color:#D8DEE9FF">      </span><span style="color:#88C0D0"><data-lsp lsp="(property) options: {
    worker: string;
}">options</data-lsp></span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></div><div class="line"><span style="color:#D8DEE9FF">        </span><span style="color:#88C0D0"><data-lsp lsp="(property) worker: string">worker</data-lsp></span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">scripts/eslint-worker.js</span><span style="color:#ECEFF4">&quot;</span><span style="color:#ECEFF4">,</span></div><div class="line"><span style="color:#D8DEE9FF">      </span><span style="color:#ECEFF4">},</span></div><div class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#ECEFF4">},</span></div><div class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#ECEFF4">},</span></div><div class="line"><span style="color:#ECEFF4">}</span><span style="color:#81A1C1">;</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><p>Then, we implement an <code>eslint-worker.js</code> such as this:</p><pre class="shiki min-light twoslash lsp" style="background-color:#ffffff;color:#24292eff"><div class="language-id">js</div><div class="code-container"><code><div class="line"><span style="color:#C2C3C5">// @filename: scripts/eslint-worker.js</span></div><div class="line"> </div><div class="line"><span style="color:#D32F2F">const</span><span style="color:#24292EFF"> </span><span style="color:#1976D2"><data-lsp lsp="import path">path</data-lsp></span><span style="color:#24292EFF"> </span><span style="color:#D32F2F">=</span><span style="color:#24292EFF"> </span><span style="color:#6F42C1"><data-lsp lsp="(property) require: any">require</data-lsp></span><span style="color:#24292EFF">(</span><span style="color:#22863A">&quot;path&quot;</span><span style="color:#24292EFF">);</span></div><div class="line"> </div><div class="line"><span style="color:#D32F2F">const</span><span style="color:#24292EFF"> { </span><span style="color:#1976D2"><data-lsp lsp="(alias) class ESLint
(alias) namespace ESLint
import ESLint">ESLint</data-lsp></span><span style="color:#24292EFF"> } </span><span style="color:#D32F2F">=</span><span style="color:#24292EFF"> </span><span style="color:#6F42C1"><data-lsp lsp="(property) require: any">require</data-lsp></span><span style="color:#24292EFF">(</span><span style="color:#22863A">&quot;eslint&quot;</span><span style="color:#24292EFF">);</span></div><div class="line"><span style="color:#D32F2F">const</span><span style="color:#24292EFF"> { </span><span style="color:#1976D2"><data-lsp lsp="import readFile">readFile</data-lsp></span><span style="color:#24292EFF"> } </span><span style="color:#D32F2F">=</span><span style="color:#24292EFF"> </span><span style="color:#6F42C1"><data-lsp lsp="(property) require: any">require</data-lsp></span><span style="color:#24292EFF">(</span><span style="color:#22863A">&quot;fs/promises&quot;</span><span style="color:#24292EFF">);</span></div><div class="line"> </div><div class="line"><span style="color:#C2C3C5">/** this is the workspace root - find it however you want! */</span></div><div class="line"><span style="color:#D32F2F">const</span><span style="color:#24292EFF"> </span><span style="color:#1976D2"><data-lsp lsp="const PROJECT_ROOT: any">PROJECT_ROOT</data-lsp></span><span style="color:#24292EFF"> </span><span style="color:#D32F2F">=</span><span style="color:#24292EFF"> </span><span style="color:#1976D2"><data-lsp lsp="import path">path</data-lsp></span><span style="color:#6F42C1">.<data-lsp lsp="any">resolve</data-lsp></span><span style="color:#24292EFF">(<data-lsp lsp="any">__dirname</data-lsp></span><span style="color:#212121">,</span><span style="color:#24292EFF"> </span><span style="color:#22863A">&quot;..&quot;</span><span style="color:#24292EFF">);</span></div><div class="line"> </div><div class="line"><span style="color:#C2C3C5">/** </span><span style="color:#D32F2F">@type</span><span style="color:#C2C3C5"> </span><span style="color:#6F42C1">{ESLint}</span><span style="color:#C2C3C5"> */</span></div><div class="line"><span style="color:#D32F2F">let</span><span style="color:#24292EFF"> <data-lsp lsp="let eslintInstance: ESLint">eslintInstance</data-lsp> </span><span style="color:#D32F2F">=</span><span style="color:#24292EFF"> </span><span style="color:#1976D2">null</span><span style="color:#24292EFF">;</span></div><div class="line"> </div><div class="line"><span style="color:#C2C3C5">/** caches an ESLint instance for the worker */</span></div><div class="line"><span style="color:#D32F2F">function</span><span style="color:#24292EFF"> </span><span style="color:#6F42C1"><data-lsp lsp="function getEslintInstance(): ESLint">getEslintInstance</data-lsp></span><span style="color:#24292EFF">() {</span></div><div class="line"><span style="color:#24292EFF">  </span><span style="color:#D32F2F">if</span><span style="color:#24292EFF"> (</span><span style="color:#D32F2F">!</span><span style="color:#24292EFF"><data-lsp lsp="let eslintInstance: ESLint">eslintInstance</data-lsp>) {</span></div><div class="line"><span style="color:#24292EFF">    </span><span style="color:#D32F2F">const</span><span style="color:#24292EFF"> </span><span style="color:#1976D2"><data-lsp lsp="const baseConfig: any">baseConfig</data-lsp></span><span style="color:#24292EFF"> </span><span style="color:#D32F2F">=</span><span style="color:#24292EFF"> </span><span style="color:#6F42C1"><data-lsp lsp="(property) require: any">require</data-lsp></span><span style="color:#24292EFF">(</span><span style="color:#1976D2"><data-lsp lsp="import path">path</data-lsp></span><span style="color:#6F42C1">.<data-lsp lsp="any">join</data-lsp></span><span style="color:#24292EFF">(</span><span style="color:#1976D2"><data-lsp lsp="const PROJECT_ROOT: any">PROJECT_ROOT</data-lsp></span><span style="color:#212121">,</span><span style="color:#24292EFF"> </span><span style="color:#22863A">&quot;scripts/config/eslintrc.js&quot;</span><span style="color:#24292EFF">));</span></div><div class="line"><span style="color:#24292EFF">    </span><span style="color:#1976D2"><data-lsp lsp="const baseConfig: any">baseConfig</data-lsp></span><span style="color:#24292EFF">.</span><span style="color:#1976D2"><data-lsp lsp="any">parserOptions</data-lsp></span><span style="color:#24292EFF">.<data-lsp lsp="any">project</data-lsp> </span><span style="color:#D32F2F">=</span><span style="color:#24292EFF"> </span><span style="color:#1976D2"><data-lsp lsp="import path">path</data-lsp></span><span style="color:#6F42C1">.<data-lsp lsp="any">join</data-lsp></span><span style="color:#24292EFF">(</span><span style="color:#1976D2"><data-lsp lsp="any">target</data-lsp></span><span style="color:#24292EFF">.<data-lsp lsp="any">cwd</data-lsp></span><span style="color:#212121">,</span><span style="color:#24292EFF"> </span><span style="color:#22863A">&quot;tsconfig.json&quot;</span><span style="color:#24292EFF">);</span></div><div class="line"> </div><div class="line"><span style="color:#24292EFF">    <data-lsp lsp="let eslintInstance: ESLint">eslintInstance</data-lsp> </span><span style="color:#D32F2F">=</span><span style="color:#24292EFF"> </span><span style="color:#D32F2F">new</span><span style="color:#24292EFF"> </span><span style="color:#6F42C1"><data-lsp lsp="(alias) new ESLint(options?: ESLint.Options | undefined): ESLint
import ESLint">ESLint</data-lsp></span><span style="color:#24292EFF">({</span></div><div class="line"><span style="color:#24292EFF">      <data-lsp lsp="(property) ESLint.Options.reportUnusedDisableDirectives?: Linter.RuleLevel | undefined">reportUnusedDisableDirectives</data-lsp></span><span style="color:#D32F2F">:</span><span style="color:#24292EFF"> </span><span style="color:#22863A">&quot;error&quot;</span><span style="color:#212121">,</span></div><div class="line"><span style="color:#24292EFF">      <data-lsp lsp="(property) ESLint.Options.baseConfig?: Linter.Config&lt;Linter.RulesRecord, Linter.RulesRecord&gt; | undefined">baseConfig</data-lsp></span><span style="color:#212121">,</span></div><div class="line"><span style="color:#24292EFF">      <data-lsp lsp="(property) ESLint.Options.fix?: boolean | ((message: Linter.LintMessage) =&gt; boolean) | undefined">fix</data-lsp></span><span style="color:#D32F2F">:</span><span style="color:#24292EFF"> </span><span style="color:#1976D2">false</span><span style="color:#212121">,</span></div><div class="line"><span style="color:#24292EFF">      <data-lsp lsp="(property) ESLint.Options.cache?: boolean | undefined">cache</data-lsp></span><span style="color:#D32F2F">:</span><span style="color:#24292EFF"> </span><span style="color:#1976D2">false</span><span style="color:#212121">,</span></div><div class="line"><span style="color:#24292EFF">      <data-lsp lsp="(property) ESLint.Options.cwd?: string | undefined">cwd</data-lsp></span><span style="color:#D32F2F">:</span><span style="color:#24292EFF"> </span><span style="color:#1976D2"><data-lsp lsp="any">target</data-lsp></span><span style="color:#24292EFF">.<data-lsp lsp="any">cwd</data-lsp></span><span style="color:#212121">,</span></div><div class="line"><span style="color:#24292EFF">    });</span></div><div class="line"><span style="color:#24292EFF">  }</span></div><div class="line"> </div><div class="line"><span style="color:#24292EFF">  </span><span style="color:#D32F2F">return</span><span style="color:#24292EFF"> <data-lsp lsp="let eslintInstance: ESLint">eslintInstance</data-lsp>;</span></div><div class="line"><span style="color:#24292EFF">}</span></div><div class="line"> </div><div class="line"><span style="color:#C2C3C5">/** Workers should have a run function that gets called per package task */</span></div><div class="line"><span style="color:#D32F2F">async</span><span style="color:#24292EFF"> </span><span style="color:#D32F2F">function</span><span style="color:#24292EFF"> </span><span style="color:#6F42C1"><data-lsp lsp="function run(data: any): Promise&lt;void&gt;">run</data-lsp></span><span style="color:#24292EFF">(<data-lsp lsp="(parameter) data: any">data</data-lsp>) {</span></div><div class="line"><span style="color:#24292EFF">  </span><span style="color:#D32F2F">const</span><span style="color:#24292EFF"> { </span><span style="color:#1976D2"><data-lsp lsp="const target: any">target</data-lsp></span><span style="color:#24292EFF"> } </span><span style="color:#D32F2F">=</span><span style="color:#24292EFF"> <data-lsp lsp="(parameter) data: any">data</data-lsp>;</span></div><div class="line"> </div><div class="line"><span style="color:#24292EFF">  </span><span style="color:#D32F2F">const</span><span style="color:#24292EFF"> </span><span style="color:#1976D2"><data-lsp lsp="const eslint: ESLint">eslint</data-lsp></span><span style="color:#24292EFF"> </span><span style="color:#D32F2F">=</span><span style="color:#24292EFF"> </span><span style="color:#6F42C1"><data-lsp lsp="function getEslintInstance(): ESLint">getEslintInstance</data-lsp></span><span style="color:#24292EFF">();</span></div><div class="line"> </div><div class="line"><span style="color:#24292EFF">  </span><span style="color:#C2C3C5">// You can also use &quot;options&quot; to pass different files pattern to lint</span></div><div class="line"><span style="color:#24292EFF">  </span><span style="color:#C2C3C5">// e.g. data.options.files; you&#x27;ll need to then configure this inside lage.config.js&#x27;s pipeline</span></div><div class="line"><span style="color:#24292EFF">  </span><span style="color:#D32F2F">const</span><span style="color:#24292EFF"> </span><span style="color:#1976D2"><data-lsp lsp="const files: &quot;src/**/*.ts&quot;">files</data-lsp></span><span style="color:#24292EFF"> </span><span style="color:#D32F2F">=</span><span style="color:#24292EFF"> </span><span style="color:#22863A">&quot;src/**/*.ts&quot;</span><span style="color:#24292EFF">;</span></div><div class="line"> </div><div class="line"><span style="color:#24292EFF">  </span><span style="color:#D32F2F">const</span><span style="color:#24292EFF"> </span><span style="color:#1976D2"><data-lsp lsp="const results: ESLint.LintResult[]">results</data-lsp></span><span style="color:#24292EFF"> </span><span style="color:#D32F2F">=</span><span style="color:#24292EFF"> </span><span style="color:#D32F2F">await</span><span style="color:#24292EFF"> </span><span style="color:#1976D2"><data-lsp lsp="const eslint: ESLint">eslint</data-lsp></span><span style="color:#6F42C1">.<data-lsp lsp="(method) ESLint.lintFiles(patterns: string | string[]): Promise&lt;ESLint.LintResult[]&gt;">lintFiles</data-lsp></span><span style="color:#24292EFF">(<data-lsp lsp="const files: &quot;src/**/*.ts&quot;">files</data-lsp>);</span></div><div class="line"> </div><div class="line"><span style="color:#24292EFF">  </span><span style="color:#D32F2F">const</span><span style="color:#24292EFF"> </span><span style="color:#1976D2"><data-lsp lsp="const formatter: ESLint.Formatter">formatter</data-lsp></span><span style="color:#24292EFF"> </span><span style="color:#D32F2F">=</span><span style="color:#24292EFF"> </span><span style="color:#D32F2F">await</span><span style="color:#24292EFF"> </span><span style="color:#1976D2"><data-lsp lsp="const eslint: ESLint">eslint</data-lsp></span><span style="color:#6F42C1">.<data-lsp lsp="(method) ESLint.loadFormatter(nameOrPath?: string | undefined): Promise&lt;ESLint.Formatter&gt;">loadFormatter</data-lsp></span><span style="color:#24292EFF">(</span><span style="color:#22863A">&quot;stylish&quot;</span><span style="color:#24292EFF">);</span></div><div class="line"> </div><div class="line"><span style="color:#24292EFF">  </span><span style="color:#D32F2F">const</span><span style="color:#24292EFF"> </span><span style="color:#1976D2"><data-lsp lsp="const resultText: string | Promise&lt;string&gt;">resultText</data-lsp></span><span style="color:#24292EFF"> </span><span style="color:#D32F2F">=</span><span style="color:#24292EFF"> </span><span style="color:#1976D2"><data-lsp lsp="const formatter: ESLint.Formatter">formatter</data-lsp></span><span style="color:#6F42C1">.<data-lsp lsp="(method) ESLint.Formatter.format(results: ESLint.LintResult[], data?: ESLint.LintResultData | undefined): string | Promise&lt;string&gt;">format</data-lsp></span><span style="color:#24292EFF">(<data-lsp lsp="const results: ESLint.LintResult[]">results</data-lsp>);</span></div><div class="line"> </div><div class="line"><span style="color:#24292EFF">  </span><span style="color:#C2C3C5">// Output results to stdout</span></div><div class="line"><span style="color:#24292EFF">  </span><span style="color:#1976D2"><data-lsp lsp="any">process</data-lsp></span><span style="color:#6F42C1">.</span><span style="color:#1976D2"><data-lsp lsp="any">stdout</data-lsp></span><span style="color:#6F42C1">.<data-lsp lsp="any">write</data-lsp></span><span style="color:#24292EFF">(<data-lsp lsp="const resultText: string | Promise&lt;string&gt;">resultText</data-lsp> </span><span style="color:#D32F2F">+</span><span style="color:#24292EFF"> </span><span style="color:#22863A">&quot;\n&quot;</span><span style="color:#24292EFF">);</span></div><div class="line"> </div><div class="line"><span style="color:#24292EFF">  </span><span style="color:#D32F2F">if</span><span style="color:#24292EFF"> (</span><span style="color:#1976D2"><data-lsp lsp="const results: ESLint.LintResult[]">results</data-lsp></span><span style="color:#6F42C1">.<data-lsp lsp="(method) Array&lt;ESLint.LintResult&gt;.some(predicate: (value: ESLint.LintResult, index: number, array: ESLint.LintResult[]) =&gt; unknown, thisArg?: any): boolean">some</data-lsp></span><span style="color:#24292EFF">((<data-lsp lsp="(parameter) r: ESLint.LintResult">r</data-lsp>) </span><span style="color:#D32F2F">=&gt;</span><span style="color:#24292EFF"> </span><span style="color:#1976D2"><data-lsp lsp="(parameter) r: ESLint.LintResult">r</data-lsp></span><span style="color:#24292EFF">.<data-lsp lsp="(property) ESLint.LintResult.errorCount: number">errorCount</data-lsp> </span><span style="color:#D32F2F">&gt;</span><span style="color:#24292EFF"> </span><span style="color:#1976D2">0</span><span style="color:#24292EFF">)) {</span></div><div class="line"><span style="color:#24292EFF">    </span><span style="color:#C2C3C5">// throw an error to indicate that this task has failed</span></div><div class="line"><span style="color:#24292EFF">    </span><span style="color:#D32F2F">throw</span><span style="color:#24292EFF"> </span><span style="color:#D32F2F">new</span><span style="color:#24292EFF"> </span><span style="color:#1976D2"><data-lsp lsp="var Error: ErrorConstructor
new (message?: string | undefined) =&gt; Error">Error</data-lsp></span><span style="color:#24292EFF">(</span><span style="color:#22863A">`Linting failed with errors`</span><span style="color:#24292EFF">);</span></div><div class="line"><span style="color:#24292EFF">  }</span></div><div class="line"><span style="color:#24292EFF">}</span></div><div class="line"> </div><div class="line"><span style="color:#C2C3C5">// the module exports is picked up by `lage` to run inside a worker - the module state is preserved from target run to target run</span></div><div class="line"><span style="color:#1976D2"><data-lsp lsp="(alias) function export=(data: any): Promise&lt;void&gt;
import export=">module</data-lsp></span><span style="color:#24292EFF">.</span><span style="color:#1976D2"><data-lsp lsp="(alias) function export=(data: any): Promise&lt;void&gt;
import export=">exports</data-lsp></span><span style="color:#24292EFF"> </span><span style="color:#D32F2F">=</span><span style="color:#24292EFF"> <data-lsp lsp="function run(data: any): Promise&lt;void&gt;">run</data-lsp>;</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><pre class="shiki nord twoslash lsp" style="background-color:#2e3440ff;color:#d8dee9ff"><div class="language-id">js</div><div class="code-container"><code><div class="line"><span style="color:#616E88">// @filename: scripts/eslint-worker.js</span></div><div class="line"> </div><div class="line"><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9"><data-lsp lsp="import path">path</data-lsp></span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0"><data-lsp lsp="(property) require: any">require</data-lsp></span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">path</span><span style="color:#ECEFF4">&quot;</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></div><div class="line"> </div><div class="line"><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9"><data-lsp lsp="(alias) class ESLint
(alias) namespace ESLint
import ESLint">ESLint</data-lsp></span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0"><data-lsp lsp="(property) require: any">require</data-lsp></span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">eslint</span><span style="color:#ECEFF4">&quot;</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></div><div class="line"><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9"><data-lsp lsp="import readFile">readFile</data-lsp></span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0"><data-lsp lsp="(property) require: any">require</data-lsp></span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">fs/promises</span><span style="color:#ECEFF4">&quot;</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></div><div class="line"> </div><div class="line"><span style="color:#616E88">/** this is the workspace root - find it however you want! */</span></div><div class="line"><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9"><data-lsp lsp="const PROJECT_ROOT: any">PROJECT_ROOT</data-lsp></span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9"><data-lsp lsp="import path">path</data-lsp></span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0"><data-lsp lsp="any">resolve</data-lsp></span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9"><data-lsp lsp="any">__dirname</data-lsp></span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">..</span><span style="color:#ECEFF4">&quot;</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></div><div class="line"> </div><div class="line"><span style="color:#616E88">/** </span><span style="color:#ECEFF4">@</span><span style="color:#8FBCBB">type</span><span style="color:#616E88"> </span><span style="color:#ECEFF4">{</span><span style="color:#616E88">ESLint</span><span style="color:#ECEFF4">}</span><span style="color:#616E88"> */</span></div><div class="line"><span style="color:#81A1C1">let</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9"><data-lsp lsp="let eslintInstance: ESLint">eslintInstance</data-lsp></span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">null;</span></div><div class="line"> </div><div class="line"><span style="color:#616E88">/** caches an ESLint instance for the worker */</span></div><div class="line"><span style="color:#81A1C1">function</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0"><data-lsp lsp="function getEslintInstance(): ESLint">getEslintInstance</data-lsp></span><span style="color:#ECEFF4">()</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></div><div class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#81A1C1">if</span><span style="color:#D8DEE9FF"> (</span><span style="color:#81A1C1">!</span><span style="color:#D8DEE9"><data-lsp lsp="let eslintInstance: ESLint">eslintInstance</data-lsp></span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></div><div class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9"><data-lsp lsp="const baseConfig: any">baseConfig</data-lsp></span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0"><data-lsp lsp="(property) require: any">require</data-lsp></span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9"><data-lsp lsp="import path">path</data-lsp></span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0"><data-lsp lsp="any">join</data-lsp></span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9"><data-lsp lsp="const PROJECT_ROOT: any">PROJECT_ROOT</data-lsp></span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">scripts/config/eslintrc.js</span><span style="color:#ECEFF4">&quot;</span><span style="color:#D8DEE9FF">))</span><span style="color:#81A1C1">;</span></div><div class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#D8DEE9"><data-lsp lsp="const baseConfig: any">baseConfig</data-lsp></span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9"><data-lsp lsp="any">parserOptions</data-lsp></span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9"><data-lsp lsp="any">project</data-lsp></span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9"><data-lsp lsp="import path">path</data-lsp></span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0"><data-lsp lsp="any">join</data-lsp></span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9"><data-lsp lsp="any">target</data-lsp></span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9"><data-lsp lsp="any">cwd</data-lsp></span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">tsconfig.json</span><span style="color:#ECEFF4">&quot;</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></div><div class="line"> </div><div class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#D8DEE9"><data-lsp lsp="let eslintInstance: ESLint">eslintInstance</data-lsp></span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">new</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0"><data-lsp lsp="(alias) new ESLint(options?: ESLint.Options | undefined): ESLint
import ESLint">ESLint</data-lsp></span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">{</span></div><div class="line"><span style="color:#D8DEE9FF">      </span><span style="color:#88C0D0"><data-lsp lsp="(property) ESLint.Options.reportUnusedDisableDirectives?: Linter.RuleLevel | undefined">reportUnusedDisableDirectives</data-lsp></span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">error</span><span style="color:#ECEFF4">&quot;</span><span style="color:#ECEFF4">,</span></div><div class="line"><span style="color:#D8DEE9FF">      </span><span style="color:#D8DEE9"><data-lsp lsp="(property) ESLint.Options.baseConfig?: Linter.Config&lt;Linter.RulesRecord, Linter.RulesRecord&gt; | undefined">baseConfig</data-lsp></span><span style="color:#ECEFF4">,</span></div><div class="line"><span style="color:#D8DEE9FF">      </span><span style="color:#88C0D0"><data-lsp lsp="(property) ESLint.Options.fix?: boolean | ((message: Linter.LintMessage) =&gt; boolean) | undefined">fix</data-lsp></span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">false</span><span style="color:#ECEFF4">,</span></div><div class="line"><span style="color:#D8DEE9FF">      </span><span style="color:#88C0D0"><data-lsp lsp="(property) ESLint.Options.cache?: boolean | undefined">cache</data-lsp></span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">false</span><span style="color:#ECEFF4">,</span></div><div class="line"><span style="color:#D8DEE9FF">      </span><span style="color:#88C0D0"><data-lsp lsp="(property) ESLint.Options.cwd?: string | undefined">cwd</data-lsp></span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9"><data-lsp lsp="any">target</data-lsp></span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9"><data-lsp lsp="any">cwd</data-lsp></span><span style="color:#ECEFF4">,</span></div><div class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></div><div class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#ECEFF4">}</span></div><div class="line"> </div><div class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#81A1C1">return</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9"><data-lsp lsp="let eslintInstance: ESLint">eslintInstance</data-lsp></span><span style="color:#81A1C1">;</span></div><div class="line"><span style="color:#ECEFF4">}</span></div><div class="line"> </div><div class="line"><span style="color:#616E88">/** Workers should have a run function that gets called per package task */</span></div><div class="line"><span style="color:#81A1C1">async</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">function</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0"><data-lsp lsp="function run(data: any): Promise&lt;void&gt;">run</data-lsp></span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9"><data-lsp lsp="(parameter) data: any">data</data-lsp></span><span style="color:#ECEFF4">)</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></div><div class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9"><data-lsp lsp="const target: any">target</data-lsp></span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9"><data-lsp lsp="(parameter) data: any">data</data-lsp></span><span style="color:#81A1C1">;</span></div><div class="line"> </div><div class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9"><data-lsp lsp="const eslint: ESLint">eslint</data-lsp></span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0"><data-lsp lsp="function getEslintInstance(): ESLint">getEslintInstance</data-lsp></span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></div><div class="line"> </div><div class="line"><span style="color:#ECEFF4">  </span><span style="color:#616E88">// You can also use &quot;options&quot; to pass different files pattern to lint</span></div><div class="line"><span style="color:#ECEFF4">  </span><span style="color:#616E88">// e.g. data.options.files; you&#x27;ll need to then configure this inside lage.config.js&#x27;s pipeline</span></div><div class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9"><data-lsp lsp="const files: &quot;src/**/*.ts&quot;">files</data-lsp></span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">src/**/*.ts</span><span style="color:#ECEFF4">&quot;</span><span style="color:#81A1C1">;</span></div><div class="line"> </div><div class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9"><data-lsp lsp="const results: ESLint.LintResult[]">results</data-lsp></span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">await</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9"><data-lsp lsp="const eslint: ESLint">eslint</data-lsp></span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0"><data-lsp lsp="(method) ESLint.lintFiles(patterns: string | string[]): Promise&lt;ESLint.LintResult[]&gt;">lintFiles</data-lsp></span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9"><data-lsp lsp="const files: &quot;src/**/*.ts&quot;">files</data-lsp></span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></div><div class="line"> </div><div class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9"><data-lsp lsp="const formatter: ESLint.Formatter">formatter</data-lsp></span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">await</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9"><data-lsp lsp="const eslint: ESLint">eslint</data-lsp></span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0"><data-lsp lsp="(method) ESLint.loadFormatter(nameOrPath?: string | undefined): Promise&lt;ESLint.Formatter&gt;">loadFormatter</data-lsp></span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">stylish</span><span style="color:#ECEFF4">&quot;</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></div><div class="line"> </div><div class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9"><data-lsp lsp="const resultText: string | Promise&lt;string&gt;">resultText</data-lsp></span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9"><data-lsp lsp="const formatter: ESLint.Formatter">formatter</data-lsp></span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0"><data-lsp lsp="(method) ESLint.Formatter.format(results: ESLint.LintResult[], data?: ESLint.LintResultData | undefined): string | Promise&lt;string&gt;">format</data-lsp></span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9"><data-lsp lsp="const results: ESLint.LintResult[]">results</data-lsp></span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></div><div class="line"> </div><div class="line"><span style="color:#ECEFF4">  </span><span style="color:#616E88">// Output results to stdout</span></div><div class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#D8DEE9"><data-lsp lsp="any">process</data-lsp></span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9"><data-lsp lsp="any">stdout</data-lsp></span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0"><data-lsp lsp="any">write</data-lsp></span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9"><data-lsp lsp="const resultText: string | Promise&lt;string&gt;">resultText</data-lsp></span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">+</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#EBCB8B">\n</span><span style="color:#ECEFF4">&quot;</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></div><div class="line"> </div><div class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#81A1C1">if</span><span style="color:#D8DEE9FF"> (</span><span style="color:#D8DEE9"><data-lsp lsp="const results: ESLint.LintResult[]">results</data-lsp></span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0"><data-lsp lsp="(method) Array&lt;ESLint.LintResult&gt;.some(predicate: (value: ESLint.LintResult, index: number, array: ESLint.LintResult[]) =&gt; unknown, thisArg?: any): boolean">some</data-lsp></span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9"><data-lsp lsp="(parameter) r: ESLint.LintResult">r</data-lsp></span><span style="color:#ECEFF4">)</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=&gt;</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9"><data-lsp lsp="(parameter) r: ESLint.LintResult">r</data-lsp></span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9"><data-lsp lsp="(property) ESLint.LintResult.errorCount: number">errorCount</data-lsp></span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">&gt;</span><span style="color:#D8DEE9FF"> </span><span style="color:#B48EAD">0</span><span style="color:#D8DEE9FF">)) </span><span style="color:#ECEFF4">{</span></div><div class="line"><span style="color:#ECEFF4">    </span><span style="color:#616E88">// throw an error to indicate that this task has failed</span></div><div class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#81A1C1">throw</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">new</span><span style="color:#D8DEE9FF"> </span><span style="color:#8FBCBB"><data-lsp lsp="var Error: ErrorConstructor
new (message?: string | undefined) =&gt; Error">Error</data-lsp></span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">`</span><span style="color:#A3BE8C">Linting failed with errors</span><span style="color:#ECEFF4">`</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></div><div class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#ECEFF4">}</span></div><div class="line"><span style="color:#ECEFF4">}</span></div><div class="line"> </div><div class="line"><span style="color:#616E88">// the module exports is picked up by `lage` to run inside a worker - the module state is preserved from target run to target run</span></div><div class="line"><span style="color:#8FBCBB"><data-lsp lsp="(alias) function export=(data: any): Promise&lt;void&gt;
import export=">module</data-lsp></span><span style="color:#ECEFF4">.</span><span style="color:#8FBCBB"><data-lsp lsp="(alias) function export=(data: any): Promise&lt;void&gt;
import export=">exports</data-lsp></span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9"><data-lsp lsp="function run(data: any): Promise&lt;void&gt;">run</data-lsp></span><span style="color:#81A1C1">;</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_Ow0B padding--none margin-left--sm"><li class="tag_DFxh"><a class="tag_otG2 tagRegular_s0E1" href="/lage/docs/tags/version-2">version 2</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/microsoft/lage/docs/Cookbook/make-lint-fast.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_bHB7" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_pbO5"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/lage/docs/Cookbook/make-jest-fast"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Make Jest Fast</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/lage/docs/Cookbook/make-ts-fast"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Make TypeScript Fast</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_XG6w thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#worker-runner" class="table-of-contents__link toc-highlight">Worker Runner</a></li><li><a href="#lets-see-some-code" class="table-of-contents__link toc-highlight">Let&#39;s see some code!</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/lage/assets/js/runtime~main.7b2bdbce.js"></script>
<script src="/lage/assets/js/main.47168870.js"></script>
</body>
</html>